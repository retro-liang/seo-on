<!doctype html>
<!-- The DOCTYPE declaration above will set the     -->
<!-- browser's rendering engine into                -->
<!-- "Standards Mode". Replacing this declaration   -->
<!-- with a "Quirks Mode" doctype is not supported. -->

<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">

    <!--                                                               -->
    <!-- Consider inlining CSS to reduce the number of requested files -->
    <!--                                                               -->
    <link type="text/css" rel="stylesheet" href="css/style.css">

    <!--                                           -->
    <!-- Any title is fine                         -->
    <!--                                           -->
    <title>Web Application Starter Project</title>
    
    <!--                                           -->
    <!-- This script loads your compiled module.   -->
    <!-- If you add any GWT meta tags, they must   -->
    <!-- be added before this line.                -->
    <!--                                           -->
    <!-- <script type="text/javascript" language="javascript" src="helloworld/helloworld.nocache.js"></script> -->
  </head>

  <!--                                           -->
  <!-- The body can have arbitrary html, or      -->
  <!-- you can leave the body empty if you want  -->
  <!-- to create a completely dynamic UI.        -->
  <!--                                           -->
  <body>

    <!-- RECOMMENDED if your web app will not function without JavaScript enabled -->
    <noscript>
      <div style="width: 22em; position: absolute; left: 50%; margin-left: -11em; color: red; background-color: white; border: 1px solid red; padding: 4px; font-family: sans-serif">
        Your web browser must have JavaScript enabled
        in order for this application to display correctly.
      </div>
    </noscript>
    
<!-- Load Queue widget CSS and jQuery -->
<style type="text/css">@import url(/js/plupload/jquery.plupload.queue/css/jquery.plupload.queue.css);</style>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>

<!-- Third party script for BrowserPlus runtime (Google Gears included in Gears runtime now) -->
<script type="text/javascript" src="http://bp.yahooapis.com/2.4.21/browserplus-min.js"></script>

<!-- Load plupload and all it's runtimes and finally the jQuery queue widget -->
<script type="text/javascript" src="/js/plupload/plupload.full.js"></script>
<script type="text/javascript" src="/js/plupload/jquery.plupload.queue/jquery.plupload.queue.js"></script>

<script type="text/javascript">
// Convert divs to queue widgets when the DOM is ready
$(function() {
	$("#uploader").pluploadQueue({
		// General settings
		runtimes : 'gears,flash,silverlight,browserplus,html5',
		url : '/spring/',
		max_file_size : '10mb',
		chunk_size : '1mb',
		unique_names : true,

		// Resize images on clientside if we can
		//resize : {width : 320, height : 240, quality : 90},

		// Specify what files to browse for
		filters : [
			{title : "Image files", extensions : "jpg,gif,png"},
			{title : "Zip files", extensions : "zip"}
		],

		// Flash settings
		flash_swf_url : '/js/plupload/plupload.flash.swf',

		// Silverlight settings
		silverlight_xap_url : '/js/plupload/plupload.silverlight.xap',
		
		init : {
			FileUploaded: function(up, file, info) {
				// Called when a file has finished uploading
				var key = new String(info.response);
				var fileKeys = $('#fileKeys').val();
				if(fileKeys == "")
				{
					$('#fileKeys').val(key);
				}
				else
				{
					$('#fileKeys').val(fileKeys + "," + key);
				}
				$("#seoButton").css("visibility","visible");
			}
		}
	});
	
	
	// Client side form validation
	$('#seoButton').click(function(e)
	{
		var uploader = $('#uploader').pluploadQueue();

        // Files in queue upload them first
        if (uploader.files.length > 0)
        {
			if (uploader.files.length === (uploader.total.uploaded + uploader.total.failed))
			{
             	var fileKeys = $("#fileKeys").val();
				$.ajax
				({
					type: "POST",
					url: "/spring/seo-image",
					data: {fileKeys: fileKeys},
					success: function(data)
					{ 
						alert(data);
						$("#seoedImage").attr('href',data);
						$("#seoedImage").css("visibility","visible");
						uploader.start();
					}
				});
			}
		}
        else
        {
			alert('You must queue at least one file.');
        }

        return false;
    });
});
</script>

    <h1></h1>

    <table align="center">
      <tr>
        <td>
       		<div id="uploader">
				<p>You browser doesn't have Flash, Silverlight, Gears, BrowserPlus or HTML5 support.</p>
			</div>
			
			<br style="clear: both" />
			<input type="hidden" id="fileKeys" name="fileKeys" />
			
        </td>
      </tr>
      <tr>
      	<td>
      		<div id="seoButton" style="visibility:hidden;position: relative;">
      			<div class="plupload_wrapper plupload_scroll">
      				<div class="plupload_container" id="uploader_container" title="Using runtime: flash">
      					<div class="plupload">
      						<div class="plupload_header">
      							<div class="plupload_header_content">
      								<div class="plupload_header_title">
      									<div class="plupload_buttons">
      										<a>SEO Image</a>
      									</div>
      								</div>
      							</div>
      						</div>
      					</div>
      				</div>
      			</div>
      		</div>
      	</td>
      </tr>
      <tr>
      	<td>
      		<a id="seoedImage" href="#" target="_blank" style="visibility:hidden;">SEOed Image</a>
      	</td>
      </tr>
    </table>
  </body>
  

</html>